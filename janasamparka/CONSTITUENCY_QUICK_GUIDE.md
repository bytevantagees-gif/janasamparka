# ğŸ¯ Quick Guide: Constituency Selection for Citizens

## âœ¨ What's New?

Citizens can now **select their constituency** once during login, and it's **saved permanently**! They can also change it later in Settings.

---

## ğŸš€ Quick Test (2 Minutes)

### Step 1: Login as New Citizen

```bash
1. Go to http://localhost:5173/login
2. Phone: +919988770001
3. OTP: 123456
4. Click "Verify & Login"
```

### Step 2: Select Constituency

You'll see a beautiful page with:
- ğŸ›ï¸ List of constituencies (Puttur, Mangalore, Bantwal)
- ğŸ“Š Details: Wards, Population
- âœ¨ Click any constituency card

### Step 3: Saved!

- âš¡ Automatic save
- ğŸš€ Redirect to your personalized dashboard
- âœ… Constituency remembered forever

---

## ğŸ¨ Visual Flow

### First Login:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“± Enter Phone             â”‚
â”‚   +919988770001             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ” Enter OTP               â”‚
â”‚   123456                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ›ï¸ Select Constituency     â”‚
â”‚                             â”‚
â”‚   [ Puttur    ]  â†Select   â”‚
â”‚   [ Mangalore ]             â”‚
â”‚   [ Bantwal   ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   âœ… Citizen Dashboard        â”‚
â”‚   Showing Puttur data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Next Login:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“± Enter Phone             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ” Enter OTP               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   âœ… Dashboard (Direct!)      â”‚
â”‚   No selection needed       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Change Constituency Anytime

### In Settings:

1. **Go to Settings** (top right menu)
2. **Scroll to Profile section**
3. **See "Constituency" dropdown**
4. **Select new constituency**
5. **Click "Update Constituency"**
6. **Done!** âœ…

---

## ğŸ¯ Features

### Constituency Selector:
- âœ… Beautiful card-based UI
- âœ… Shows ward count & population
- âœ… Hover effects
- âœ… Loading spinner during save
- âœ… Error handling

### Settings Page:
- âœ… Dropdown for citizens only
- âœ… Shows current constituency
- âœ… Change anytime
- âœ… Instant save

---

## ğŸ§ª Test Scenarios

### Scenario 1: First-Time Citizen â­
```
Phone: +919988770001
OTP: 123456
Result: See constituency selector â†’ Select â†’ Dashboard
```

### Scenario 2: Returning Citizen â­
```
Phone: +919988770001 (same as above)
OTP: 123456
Result: Skip selector â†’ Direct to dashboard
```

### Scenario 3: Change Constituency â­
```
Login â†’ Settings â†’ Profile â†’ Constituency dropdown
Select "Mangalore" â†’ Update â†’ Success!
```

### Scenario 4: Non-Citizen (Officer/MLA) â­
```
Login as Officer/MLA/Admin
Result: No constituency selector at login
Result: No constituency field in settings
```

---

## ğŸ’¾ Data Persistence

### Where It's Saved:
```
Database: users.constituency_id (UUID)
LocalStorage: user.constituency_id
Context: AuthContext.user.constituency_id
```

### When It's Used:
- âœ… Filtering complaints on dashboard
- âœ… Showing relevant analytics
- âœ… Personalizing citizen experience
- âœ… Ward-level data display

---

## ğŸ“Š UI Components

### ConstituencySelector.jsx:
```jsx
Location: /components/ConstituencySelector.jsx
Features:
  - Full-page selector
  - Constituency cards
  - Auto-save on click
  - Error handling
  - Loading states
```

### Settings.jsx (Updated):
```jsx
Location: /pages/Settings.jsx
Added:
  - Constituency dropdown (citizens only)
  - Update button
  - Loading states
  - Success/error alerts
```

### Login.jsx (Updated):
```jsx
Location: /pages/Login.jsx
Added:
  - 'constituency' step
  - Conditional selector display
  - Auto-redirect after selection
```

---

## ğŸ” How It Works

### Backend:
```python
PATCH /api/users/{user_id}
Body: { "constituency_id": "uuid-here" }
Response: { ...user, constituency_id: "uuid" }
```

### Frontend:
```javascript
// At login
if (user.role === 'citizen' && !user.constituency_id) {
  showConstituencySelector();
}

// In settings
await usersAPI.updateUser(user.id, {
  constituency_id: selectedConstituency
});
```

---

## âœ… Checklist

Before testing:
- [ ] Backend is running (`docker-compose up -d`)
- [ ] Frontend is running (`npm run dev`)
- [ ] Database has constituencies (Puttur, Mangalore, Bantwal)

Test:
- [ ] First-time citizen login â†’ See selector
- [ ] Select constituency â†’ Saved & redirected
- [ ] Second login â†’ Skip selector
- [ ] Settings â†’ Change constituency â†’ Updated
- [ ] Non-citizen login â†’ No selector

---

## ğŸ‰ Benefits

### For Citizens:
âœ… Only see relevant local complaints  
âœ… Personalized dashboard  
âœ… Set once, use forever  
âœ… Easy to change if moving  

### For System:
âœ… Better data organization  
âœ… Accurate filtering  
âœ… Constituency-level analytics  
âœ… Improved user experience  

---

## ğŸ“ Support

**Issue:** Selector not showing for citizens  
**Fix:** Check if user.constituency_id is null in database

**Issue:** Can't save constituency  
**Fix:** Verify backend API at `/api/users/{id}`

**Issue:** Dropdown empty in Settings  
**Fix:** Check constituencies API `/api/constituencies/`

---

**Status:** âœ… Ready to Test  
**Time to Test:** 2-3 minutes  
**Complexity:** Simple & Intuitive  
**Date:** October 30, 2025
